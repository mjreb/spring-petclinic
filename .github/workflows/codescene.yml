
name: CodeScene - Trigger Cloud Analysis

on:
  push:
    branches:
      - main

jobs:
  codescene-cloud-analysis:
    runs-on: ubuntu-latest

    steps:
      # El checkout no es estrictamente necesario para llamar a la API,
      # pero lo dejo por si quieres usar info del repo m√°s adelante.
      - name: Checkout (optional)
        uses: actions/checkout@v4

      - name: Trigger CodeScene analysis via REST API
        env:
          CS_API_TOKEN: ${{ secrets.CODESCENE_PAT }}     # PAT de CodeScene
          CS_PROJECT_ID: ${{ secrets.CODESCENE_PROJECT_ID }}   # ID del proyecto en CodeScene
        run: |
          set -e
          BASE_URL="https://codescene.io"
          curl -sS -X POST \
            -H "Accept: application/json" \
            -H "Authorization: Bearer ${CS_API_TOKEN}" \ 
            "${BASE_URL}/api/v2/projects/${CS_PROJECT_ID}/run-analysis"
