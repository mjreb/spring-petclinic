name: CodeScene Delta Analysis

on:
  push:
    branches:
      - "**"     # Ejecuta en TODOS los commits de TODAS las ramas

jobs:
  codescene:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0   # CodeScene necesita historial completo

      - name: Install CodeScene CLI
        run: |
          curl -s https://downloads.codescene.io/enterprise/cli/codescene-cli-linux.zip -o cli.zip
          unzip cli.zip -d codescene-cli
          chmod +x codescene-cli/codescene-cli

      - name: Run CodeScene Delta Analysis
        env:
          CODESCENE_USER: ${{ secrets.CODESCENE_USER }}
          CODESCENE_TOKEN: ${{ secrets.CODESCENE_TOKEN }}
        run: |
          ./codescene-cli/codescene-cli \
            --user "$CODESCENE_USER" \
            --password "$CODESCENE_TOKEN" \
            delta \
            --repository-path "." \
            --project-id YOUR_PROJECT_ID \
            --from HEAD~1 \
            --to HEAD
